<% provide(:title, "#{ @search_word }の検索結果") %>
<div class="search-result-and-filter">
  <% if @results_count > 0 %>
    <h4 class="search-result"><%= @search_word %> の検索結果 <%= @results_count %> 件</h4>
  <% else %>
    <h4 class="search-result">検索結果 0 件</h4>
  <% end %>
  <div data-controller="search-filter" data-action="click->search-filter#modalOpen" id="search-filter">
    <span>フィルタ</span>
    <i class="fas fa-sliders-h"></i>
  </div>
</div> 
  
<% if @search_articles.present? %>
  <%= turbo_frame_tag "search_articles_page_#{@search_articles.current_page}" do %>
    <ul id="search-or-tagged-articles" class="articles">
      <%= render partial: "articles/shared/search_articles",
                 collection: @search_articles, as: "article" %>
    </ul>
    <% if @search_articles.next_page %>
      <%= turbo_frame_tag "search_articles_page_#{@search_articles.next_page}",
          src: search_path(page: @search_articles.next_page, q: { target: @target }),
          loading: :lazy,
          class: "infinite-scroll-frame" do %>
        <div class="spinner"></div>
      <% end %>
    <% end %>
  <% end %>
<% elsif @search_lists.present? %>
  <%= turbo_frame_tag "search_lists_page_#{@search_lists.current_page}" do %>
    <ul id="search-or-tagged-articles" class="search-lists">
      <%= render partial: "favorite_article_lists/shared/search_lists",
                 collection: @search_lists, as: "list" %>
    </ul>
    <% if @search_lists.next_page %>
      <%= turbo_frame_tag "search_lists_page_#{@search_lists.next_page}",
          src: search_path(page: @search_lists.next_page, q: { target: @target }),
          loading: :lazy,
          class: "infinite-scroll-frame" do %>
        <div class="spinner"></div>
      <% end %>
    <% end %>
  <% end %>
<% elsif @search_users.present? %>
  <%= turbo_frame_tag "search_lists_page_#{@search_users.current_page}" do %>
    <ul class="search-users">
      <%= render partial: "users/shared/search_users",
                 collection: @search_users, as: "user" %>
    </ul>
    <% if @search_users.next_page %>
      <%= turbo_frame_tag "search_users_page_#{@search_users.next_page}",
          src: search_path(page: @search_users.next_page, q: { target: @target }),
          loading: :lazy,
          class: "infinite-scroll-frame" do %>
        <div class="spinner"></div>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<div id="filter-modal" data-controller="search-filter">
  <div class="filter-modal-content">
    <div class="filter-modal-header">
      <h2>検索フィルタ</h2>
      <div data-action="click->search-filter#modalCloseWithBtn" id="filter-modal-close">
        <i class="fas fa-times"></i>
      </div>
    </div>
    <hr>
    <%= form_with url: search_path, method: :get, scope: :q do |f| %>
      <%= f.search_field :title_or_content_cont,
          placeholder: "キーワード検索",
          value: params.dig(:q, :title_or_content_cont),
          class: "filter-search-window",
          data: { "search-filter-target": "searchField" },
          required: true %>
      <%= hidden_field_tag "q[created_at_filter]", params.dig(:q, :created_at_filter), 
          data: { "search-filter-target": "dateField" } %>
      <div class="filter-modal-select">
        <div class="filter-column">
          <h4>検索対象</h4>
          <label class="filter-item">
            <input type="radio" name="q[target]" value="article" data-action="change->search-filter#toggleDate change->search-filter#updateSearchParam">
            <span>記事</span>
          </label>
          <label class="filter-item">
            <input type="radio" name="q[target]" value="list" data-action="change->search-filter#toggleDate change->search-filter#updateSearchParam">
            <span>シェアリスト</span>
          </label>
          <label class="filter-item">
            <input type="radio" name="q[target]" value="user" data-action="change->search-filter#toggleDate change->search-filter#updateSearchParam">
            <span>ユーザー</span>
          </label>
        </div>

        <div class="filter-column creation-date" data-search-filter-target="creationDate">
          <h4>作成日</h4>
          <label class="filter-item">
            <input type="radio" name="q[created_at]" value="" data-action="change->search-filter#updateDateFilter" checked disabled>
            <span>指定なし</span>
          </label>
          <label class="filter-item">
            <input type="radio" name="q[created_at]" value="today" data-action="change->search-filter#updateDateFilter" disabled>
            <span>今日</span>
          </label>
          <label class="filter-item">
            <input type="radio" name="q[created_at]" value="yesterday" data-action="change->search-filter#updateDateFilter" disabled>
            <span>昨日</span>
          </label>
          <label class="filter-item">
            <input type="radio" name="q[created_at]" value="this_week" data-action="change->search-filter#updateDateFilter" disabled>
            <span>今週</span>
          </label>
          <label class="filter-item">
            <input type="radio" name="q[created_at]" value="this_month" data-action="change->search-filter#updateDateFilter" disabled>
            <span>今月</span>
          </label>
          <label class="filter-item">
            <input type="radio" name="q[created_at]" value="this_year" data-action="change->search-filter#updateDateFilter" disabled>
            <span>今年</span>
          </label>
        </div>
      </div>
      <hr>
      <div class="filter-modal-footer">
        <div class="conditions-confirmed">
          <%= f.submit "条件確定", class: "btn" %> 
        </div>
      </div>
    <% end %>
  </div>
</div>
