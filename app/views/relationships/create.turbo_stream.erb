<% referer_path = URI(request.referer.to_s).path %>
<% case referer_path %>
<% when %r{/users/#{current_user.id}/(following|followers)} %>
  <%= turbo_stream.update "follow_form_#{@user.id}" do %>
    <%= render partial: "users/unfollow" %>
  <% end %>
  <%= turbo_stream.update "following" do %>
    <%= current_user.following.count %>
  <% end %>
<% when %r{/users/#{@user.id}/(favorite_article_lists|following|followers)} %>
  <%= turbo_stream.update "follow_form" do %>
    <%= render partial: "users/unfollow" %>
  <% end %>
  <%= turbo_stream.update "followers" do %>
    <%= @user.followers.count %>
  <% end %>
  <% if referer_path.match?(%r{/users/#{@user.id}/following}) %>
    <%= turbo_stream.update "follow_form_#{@user.id}" do %>
      <%= render partial: "users/unfollow" %>
    <% end %>
  <% end %>
<% when %r{/users/#{@user.id}$} %>
  <%= turbo_stream.update "follow_form" do %>
    <%= render partial: "users/unfollow" %>
  <% end %>
  <%= turbo_stream.update "followers" do %>
    <%= @user.followers.count %>
  <% end %>
<% else %>
  <%= turbo_stream.update "follow_form_#{@user.id}" do %>
    <%= render partial: "users/unfollow" %>
  <% end %>
<% end %>

